name: CI - Testes AutomÃ¡ticos

on:
  push:
    branches: [ "**" ]
  pull_request:
    branches: [ "**" ]

jobs:
  # --- TESTES DO BACKEND (.NET) ---
  test-backend:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./backend

    steps:
    - name: ğŸ“¥ Fazer o Checkout do cÃ³digo
      uses: actions/checkout@v4

    - name: âš™ï¸ Preparar o .NET 10
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '10.0.x'

    - name: ğŸ“¦ Restaurar dependÃªncias
      run: dotnet restore

    - name: ğŸ”¨ Compilar o projeto (Build)
      run: dotnet build PasswordManagerAPI.Tests/PasswordManagerAPI.Tests.csproj

    - name: ğŸ§ª Executar Testes
      run: dotnet test PasswordManagerAPI.Tests/PasswordManagerAPI.Tests.csproj --no-build --verbosity normal


  # --- TESTES DO FRONTEND (React/Node) ---
  test-frontend:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./frontend

    steps:
    - name: ğŸ“¥ Fazer o Checkout do cÃ³digo
      uses: actions/checkout@v4

    - name: âš™ï¸ Preparar o Node.js 20
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        cache-dependency-path: './frontend/package-lock.json'

    - name: ğŸ“¦ Instalar dependÃªncias (npm ci)
      run: npm ci 

    - name: ğŸ”¨ Checar se o Build funciona
      run: npm run build

    - name: ğŸ§ª Executar Testes
      run: npm test